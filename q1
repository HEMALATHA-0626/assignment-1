<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>University Course Registration</title>
<style>
  :root{
    --bg:#0f172a;          /* slate-900 */
    --panel:#111827;       /* gray-900 */
    --muted:#1f2937;       /* gray-800 */
    --text:#e5e7eb;        /* gray-200 */
    --sub:#9ca3af;         /* gray-400 */
    --acc:#6366f1;         /* indigo-500 */
    --acc-2:#22c55e;       /* green-500 */
    --warn:#f59e0b;        /* amber-500 */
    --err:#ef4444;         /* red-500 */
    --ok:#10b981;          /* emerald-500 */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:linear-gradient(180deg,#0b1024,#0f172a);
    color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  .container{
    max-width:1200px;margin:auto;padding:24px;
  }
  header{
    display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px;
  }
  .brand{display:flex;gap:12px;align-items:center}
  .logo{
    width:44px;height:44px;border-radius:12px;background:
      radial-gradient(circle at 30% 30%, #6ee7b7, transparent 40%),
      radial-gradient(circle at 70% 70%, #818cf8, transparent 40%),
      linear-gradient(135deg,#1e293b,#0b1024);
    box-shadow:0 10px 30px rgba(99,102,241,.25), inset 0 0 12px rgba(255,255,255,.05);
  }
  h1{font-size:1.4rem;margin:0}
  .badge{
    font-size:.75rem;background:rgba(99,102,241,.15);color:#c7d2fe;
    padding:6px 10px;border-radius:999px;border:1px solid rgba(99,102,241,.35)
  }

  .grid{
    display:grid;gap:16px;grid-template-columns: 1fr 320px;
  }
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

  .card{
    background:rgba(17,24,39,.8);
    border:1px solid rgba(148,163,184,.12);
    border-radius:18px;padding:16px;
    box-shadow: 0 8px 28px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
    backdrop-filter: blur(6px);
  }
  .card h2{margin:0 0 12px 0;font-size:1.1rem}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

  input[type="text"], input[type="email"], select{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(148,163,184,.22);
    background: #0b1220;color:var(--text);outline:none;
  }
  input::placeholder{color:#94a3b8}
  .help{font-size:.8rem;color:var(--sub)}
  .error{color:var(--err);font-size:.85rem;margin-top:6px}
  .ok{color:var(--ok)}
  .btn{
    border:1px solid rgba(148,163,184,.22);
    background:linear-gradient(180deg,#1f2937,#111827);
    color:var(--text);padding:9px 12px;border-radius:12px;cursor:pointer;
    transition:.15s;display:inline-flex;gap:8px;align-items:center;font-weight:600
  }
  .btn:hover{transform:translateY(-1px);border-color:rgba(99,102,241,.45)}
  .btn.primary{background:linear-gradient(180deg,#4f46e5,#4338ca);border-color:#6366f1}
  .btn.success{background:linear-gradient(180deg,#16a34a,#15803d);border-color:#22c55e}
  .btn.warn{background:linear-gradient(180deg,#f59e0b,#b45309);border-color:#f59e0b}
  .btn.ghost{background:transparent}
  .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}

  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
  .toolbar input{max-width:300px}
  .pill{
    font-size:.75rem;padding:4px 8px;border-radius:999px;border:1px solid rgba(148,163,184,.25);
    color:#cbd5e1;background:#0b1220;white-space:nowrap
  }

  table{width:100%;border-collapse: collapse}
  th,td{padding:10px;border-bottom:1px dashed rgba(148,163,184,.14);vertical-align:top}
  th{text-align:left;color:#cbd5e1;font-size:.85rem}
  tr:hover td{background:rgba(99,102,241,.04)}
  .code{font-family: ui-monospace,SFMono-Regular,Menlo,monospace; background:#0b1220;padding:1px 8px;border-radius:8px;border:1px solid rgba(148,163,184,.18)}
  .cap{font-variant-numeric: tabular-nums}
  .full{color:#fca5a5;font-weight:700}
  .avail{color:#86efac;font-weight:700}

  .chip{display:inline-flex;gap:6px;align-items:center;padding:3px 8px;border-radius:999px;
    background:rgba(148,163,184,.12);border:1px solid rgba(148,163,184,.2);font-size:.75rem}

  .section-title{display:flex;align-items:center;gap:8px;margin:0 0 8px 0}
  .section-title .dot{width:8px;height:8px;border-radius:50%;background:var(--acc);box-shadow:0 0 12px var(--acc)}

  .list{display:flex;flex-direction:column;gap:8px}
  .list .item{display:flex;justify-content:space-between;gap:10px;align-items:center;padding:10px;border:1px dashed rgba(148,163,184,.16);border-radius:12px}

  dialog{
    border:none;border-radius:16px;padding:0;max-width:720px;width:min(92vw,720px);color:#0b1220
  }
  dialog::backdrop{background:rgba(2,6,23,.6)}
  .modal{
    background:white;border-radius:16px;overflow:hidden
  }
  .modal header{
    background:linear-gradient(180deg,#1f2937,#111827);color:#e5e7eb;padding:14px 16px;margin:0
  }
  .modal .body{padding:16px;background:#f8fafc}
  .modal .meta{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .modal .foot{display:flex;justify-content:flex-end;gap:10px;padding:12px 16px;background:#f1f5f9}

  .toast{
    position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:10px;z-index:99
  }
  .toast .t{
    background:#111827;color:#e5e7eb;border:1px solid rgba(148,163,184,.25);padding:10px 12px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4)
  }
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>TechU — Course Registration</h1>
          <div class="help">Register, view details, check availability, and manage your schedule in real time.</div>
        </div>
      </div>
      <span class="badge">Single-Page App</span>
    </header>

    <div class="grid">
      <!-- Left: Courses -->
      <section class="card">
        <div class="section-title"><span class="dot"></span><h2>Browse Courses</h2></div>
        <div class="toolbar">
          <input id="q" type="text" placeholder="Search by code, title, instructor…" aria-label="Search courses"/>
          <select id="dept">
            <option value="">All departments</option>
            <option value="CSE">CSE</option>
            <option value="ECE">ECE</option>
            <option value="MAT">MAT</option>
            <option value="HUM">HUM</option>
          </select>
          <label class="pill"><input id="onlyOpen" type="checkbox" /> &nbsp;Show only open courses</label>
          <button class="btn ghost" id="resetFilters">Reset</button>
        </div>

        <div class="help" id="courseCount"></div>

        <div style="overflow:auto;border-radius:12px;border:1px solid rgba(148,163,184,.12)">
          <table aria-describedby="courseCount">
            <thead>
              <tr>
                <th>Code</th>
                <th>Title</th>
                <th>Dept</th>
                <th>Credits</th>
                <th>Schedule</th>
                <th>Prerequisites</th>
                <th>Seats</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="courseRows"></tbody>
          </table>
        </div>
      </section>

      <!-- Right: Student + My Registrations -->
      <aside class="card">
        <div class="section-title"><span class="dot"></span><h2>Student Profile</h2></div>
        <form id="studentForm" novalidate>
          <label>Full Name
            <input type="text" id="studentName" name="studentName" placeholder="e.g., Ananya Iyer" required />
          </label>
          <div class="error" data-error-for="studentName"></div>

          <label style="margin-top:8px">Email
            <input type="email" id="studentEmail" name="studentEmail" placeholder="name@techu.edu" required />
          </label>
          <div class="error" data-error-for="studentEmail"></div>

          <label style="margin-top:8px">Student ID
            <input type="text" id="studentId" name="studentId" placeholder="e.g., TU24AIDS001" required pattern="[A-Za-z0-9-]{6,}" />
          </label>
          <div class="error" data-error-for="studentId"></div>

          <details style="margin-top:10px">
            <summary><strong>Completed Courses (for prerequisites)</strong></summary>
            <div class="help">Tick the courses you have already completed.</div>
            <div id="completedList" class="list" style="margin-top:8px"></div>
          </details>

          <div class="row" style="margin-top:10px">
            <button type="submit" class="btn primary" id="saveProfile">Save Profile</button>
            <button type="button" class="btn" id="clearProfile">Clear</button>
          </div>
          <div class="help" id="profileStatus" role="status" aria-live="polite"></div>
        </form>

        <hr style="border:none;border-top:1px dashed rgba(148,163,184,.25);margin:16px 0" />

        <div class="section-title"><span class="dot"></span><h2>My Registrations</h2></div>
        <div id="myRegs" class="list" aria-live="polite" aria-relevant="all"></div>
        <div class="row" style="margin-top:8px">
          <button class="btn success" id="exportBtn">Export as JSON</button>
          <a id="downloadLink" class="btn ghost" style="display:none">Download</a>
        </div>
      </aside>
    </div>
  </div>

  <!-- Course Detail Modal -->
  <dialog id="courseDialog" aria-labelledby="dlgTitle">
    <div class="modal">
      <header>
        <h3 id="dlgTitle" style="margin:0;font-size:1.1rem"></h3>
      </header>
      <div class="body">
        <div class="meta" id="dlgMeta"></div>
        <p id="dlgDesc" style="margin:8px 0 0 0;line-height:1.5"></p>
      </div>
      <div class="foot">
        <button class="btn" id="dlgClose">Close</button>
        <button class="btn primary" id="dlgRegister">Register</button>
      </div>
    </div>
  </dialog>

  <!-- Toasts -->
  <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>

<script>
/* =========================
   Data (could come from API)
   ========================= */
const COURSE_DATA = [
  {
    code:"CSE101", title:"Introduction to Programming", dept:"CSE", credits:4,
    schedule:"Mon 9:00–10:30", capacity:3, enrolled:0,
    prereqs:[], instructor:"Dr. Rao",
    description:"Fundamentals of programming using Python. Variables, control flow, functions, lists, and problem solving."
  },
  {
    code:"CSE201", title:"Data Structures", dept:"CSE", credits:4,
    schedule:"Tue 11:00–12:30", capacity:2, enrolled:0,
    prereqs:["CSE101"], instructor:"Prof. Kannan",
    description:"Linear and non-linear data structures, complexity, recursion, stacks, queues, linked lists, trees, graphs."
  },
  {
    code:"CSE301", title:"Algorithms", dept:"CSE", credits:4,
    schedule:"Thu 14:00–15:30", capacity:2, enrolled:0,
    prereqs:["CSE201"], instructor:"Dr. Priya",
    description:"Design and analysis of algorithms, greedy, divide & conquer, dynamic programming, graph algorithms."
  },
  {
    code:"ECE210", title:"Digital Logic Design", dept:"ECE", credits:3,
    schedule:"Wed 10:00–11:30", capacity:2, enrolled:0,
    prereqs:[], instructor:"Dr. Chatterjee",
    description:"Number systems, boolean algebra, combinational & sequential circuits, minimization, state machines."
  },
  {
    code:"MAT110", title:"Discrete Mathematics", dept:"MAT", credits:3,
    schedule:"Fri 09:00–10:30", capacity:2, enrolled:0,
    prereqs:[], instructor:"Dr. Menon",
    description:"Logic, sets, relations, functions, combinatorics, graphs and trees relevant to computer science."
  },
  {
    code:"HUM101", title:"Professional Communication", dept:"HUM", credits:2,
    schedule:"Mon 12:00–13:00", capacity:2, enrolled:0,
    prereqs:[], instructor:"Ms. Thomas",
    description:"Foundational writing and presentation skills for engineers, with emphasis on clarity and audience."
  }
];

/* ==================================
   Tiny store (in-memory + localStorage)
   ================================== */
const store = {
  courses: JSON.parse(localStorage.getItem("courses")||"null") || COURSE_DATA,
  profile: JSON.parse(localStorage.getItem("profile")||"null") || {name:"", email:"", id:"", completed:[]},
  regs:    JSON.parse(localStorage.getItem("regs")||"null")    || [], // list of course codes
};
const save = () => {
  localStorage.setItem("courses", JSON.stringify(store.courses));
  localStorage.setItem("profile", JSON.stringify(store.profile));
  localStorage.setItem("regs", JSON.stringify(store.regs));
};

/* ======================
   Utilities & Validation
   ====================== */
const el = sel => document.querySelector(sel);
const els = sel => Array.from(document.querySelectorAll(sel));
const toast = (msg, kind="info", timeout=2600) => {
  const t = document.createElement("div");
  t.className = "t";
  t.textContent = msg;
  if(kind==="ok") t.style.borderColor = "rgba(16,185,129,.6)";
  if(kind==="warn") t.style.borderColor = "rgba(245,158,11,.6)";
  if(kind==="err") t.style.borderColor = "rgba(239,68,68,.6)";
  el("#toast").appendChild(t);
  setTimeout(()=> t.remove(), timeout);
};

// Generic field validator
const validators = {
  required: val => val.trim().length>0 || "This field is required.",
  email: val => (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val) || "Enter a valid email."),
  pattern: (val, re, msg) => (new RegExp(re).test(val) || msg || "Invalid format."),
};
function showFieldError(field, msg){
  const box = document.querySelector(`[data-error-for="${field.id}"]`);
  if(box){ box.textContent = msg || ""; }
  field.setAttribute("aria-invalid", msg ? "true" : "false");
}
function validateForm(form){
  let ok = true;
  // name
  const name = form.studentName;
  const v1 = validators.required(name.value);
  if(v1!==true){ showFieldError(name, v1); ok=false; } else showFieldError(name, "");
  // email
  const email = form.studentEmail;
  const v2 = validators.required(email.value)===true ? validators.email(email.value) : validators.required(email.value);
  if(v2!==true){ showFieldError(email, v2); ok=false; } else showFieldError(email, "");
  // id
  const sid = form.studentId;
  const v3 = validators.required(sid.value)===true ? validators.pattern(sid.value, "^[A-Za-z0-9-]{6,}$", "Min 6 chars (letters/digits/hyphen).") : validators.required(sid.value);
  if(v3!==true){ showFieldError(sid, v3); ok=false; } else showFieldError(sid, "");
  return ok;
}

// prereq check
const hasPrereqs = (completed, course) => course.prereqs.every(p => completed.includes(p));
// availability helpers
const remainingSeats = c => Math.max(0, c.capacity - c.enrolled);
const isFull = c => remainingSeats(c) === 0;

/* ===================
   Rendering functions
   =================== */
function renderCompletedList(){
  const host = el("#completedList");
  host.innerHTML = "";
  store.courses.forEach(c=>{
    const id = `cmp-${c.code}`;
    const row = document.createElement("label");
    row.className = "item";
    row.innerHTML = `
      <span><span class="code">${c.code}</span> — ${c.title}</span>
      <input type="checkbox" id="${id}" data-code="${c.code}">
    `;
    host.appendChild(row);
  });
  // set checked from profile
  store.profile.completed.forEach(code=>{
    const chk = host.querySelector(`input[data-code="${code}"]`);
    if(chk) chk.checked = true;
  });
}

function renderCourses(){
  const q = el("#q").value.trim().toLowerCase();
  const dept = el("#dept").value;
  const onlyOpen = el("#onlyOpen").checked;

  const rows = el("#courseRows");
  rows.innerHTML = "";

  let list = store.courses.filter(c=>{
    const text = `${c.code} ${c.title} ${c.dept} ${c.instructor}`.toLowerCase();
    const passSearch = q ? text.includes(q) : true;
    const passDept = dept ? c.dept === dept : true;
    const passOpen = onlyOpen ? !isFull(c) : true;
    return passSearch && passDept && passOpen;
  });

  el("#courseCount").textContent = `Showing ${list.length} of ${store.courses.length} course(s).`;

  list.forEach(c=>{
    const tr = document.createElement("tr");
    const prereqHTML = c.prereqs.length ? c.prereqs.map(p=>`<span class="chip"><span class="code">${p}</span></span>`).join(" ") : `<span class="help">None</span>`;
    const seatsRem = remainingSeats(c);
    const seatsHtml = seatsRem === 0 ? `<span class="cap full">FULL</span>` : `<span class="cap avail">${seatsRem}</span> / <span class="cap">${c.capacity}</span>`;

    const already = store.regs.includes(c.code);
    tr.innerHTML = `
      <td><span class="code">${c.code}</span></td>
      <td>${c.title}<div class="help">${c.instructor}</div></td>
      <td>${c.dept}</td>
      <td>${c.credits}</td>
      <td>${c.schedule}</td>
      <td>${prereqHTML}</td>
      <td>${seatsHtml}</td>
      <td class="row">
        <button class="btn" data-act="view" data-code="${c.code}">Details</button>
        <button class="btn primary" data-act="reg" data-code="${c.code}" ${isFull(c) || already ? "disabled": ""}>${already ? "Registered" : "Register"}</button>
      </td>
    `;
    rows.appendChild(tr);
  });
}

function renderMyRegs(){
  const host = el("#myRegs");
  host.innerHTML = "";
  if(store.regs.length === 0){
    host.innerHTML = `<div class="help">No courses registered yet.</div>`;
    return;
  }
  store.regs.forEach(code=>{
    const c = store.courses.find(x=>x.code===code);
    const item = document.createElement("div");
    item.className = "item";
    item.innerHTML = `
      <div>
        <div><span class="code">${c.code}</span> — ${c.title}</div>
        <div class="help">${c.schedule} • ${c.credits} credit(s)</div>
      </div>
      <div class="row">
        <button class="btn warn" data-drop="${c.code}">Drop</button>
      </div>
    `;
    host.appendChild(item);
  });
}

/* ============================
   Actions: view/reg/drop/export
   ============================ */
function openCourseDialog(code){
  const c = store.courses.find(x=>x.code===code);
  el("#dlgTitle").textContent = `${c.code} — ${c.title}`;
  el("#dlgMeta").innerHTML = `
    <span class="chip"><strong>Dept:</strong> ${c.dept}</span>
    <span class="chip"><strong>Credits:</strong> ${c.credits}</span>
    <span class="chip"><strong>Instructor:</strong> ${c.instructor}</span>
    <span class="chip"><strong>Schedule:</strong> ${c.schedule}</span>
    <span class="chip"><strong>Seats:</strong> ${remainingSeats(c)}/${c.capacity}</span>
    <span class="chip"><strong>Prereqs:</strong> ${c.prereqs.length? c.prereqs.join(", "):"None"}</span>
  `;
  el("#dlgDesc").textContent = c.description;
  el("#dlgRegister").dataset.code = c.code;
  el("#courseDialog").showModal();
}

function registerFor(code){
  const c = store.courses.find(x=>x.code===code);
  if(!c){ toast("Course not found.","err"); return; }

  // Validate profile first
  const form = el("#studentForm");
  if(!validateForm(form)){
    toast("Please fix profile errors before registering.","err");
    return;
  }

  // Re-check availability
  if(isFull(c)){
    toast(`${c.code} is already full.`,"warn");
    return;
  }

  // Check duplicate
  if(store.regs.includes(code)){
    toast(`You are already registered for ${code}.`,"warn");
    return;
  }

  // Prereq check
  const completed = store.profile.completed;
  if(!hasPrereqs(completed, c)){
    toast(`Missing prerequisites: ${c.prereqs.join(", ") || "None"}. Registration blocked.`,"err");
    return;
  }

  // Register
  store.regs.push(code);
  c.enrolled += 1;
  save();
  renderCourses();
  renderMyRegs();
  toast(`Registered for ${c.code}.`,"ok");

  // auto-close dialog if open
  const dlg = el("#courseDialog");
  if(dlg.open) dlg.close();
}

function dropCourse(code){
  const idx = store.regs.indexOf(code);
  if(idx===-1) return;
  store.regs.splice(idx,1);
  const c = store.courses.find(x=>x.code===code);
  if(c){ c.enrolled = Math.max(0, c.enrolled - 1); }
  save();
  renderCourses();
  renderMyRegs();
  toast(`Dropped ${code}. Seats updated.`,"ok");
}

function exportRegs(){
  const data = {
    student: store.profile,
    registrations: store.regs.map(code=>{
      const c = store.courses.find(x=>x.code===code);
      return { code:c.code, title:c.title, credits:c.credits, schedule:c.schedule };
    }),
    exportedAt: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const link = el("#downloadLink");
  link.href = url;
  link.download = `techu-registrations-${store.profile.id||"student"}.json`;
  link.style.display = "inline-flex";
  link.textContent = "Download JSON";
  toast("Export ready.","ok");
}

/* =========================
   Profile (save/clear/track)
   ========================= */
function pullProfileFromForm(){
  return {
    name: el("#studentName").value.trim(),
    email: el("#studentEmail").value.trim(),
    id: el("#studentId").value.trim(),
    completed: els("#completedList input[type=checkbox]")
                .filter(x=>x.checked)
                .map(x=>x.dataset.code)
  };
}
function pushProfileToForm(){
  el("#studentName").value = store.profile.name || "";
  el("#studentEmail").value = store.profile.email || "";
  el("#studentId").value = store.profile.id || "";
  // completed list handled by renderCompletedList + ticks below
  els("#completedList input[type=checkbox]").forEach(chk=>{
    chk.checked = store.profile.completed.includes(chk.dataset.code);
  });
}
function saveProfile(e){
  e.preventDefault();
  const form = el("#studentForm");
  if(!validateForm(form)) return;
  store.profile = pullProfileFromForm();
  save();
  el("#profileStatus").innerHTML = `<span class="ok">Profile saved.</span>`;
  toast("Profile saved.","ok");
}
function clearProfile(){
  store.profile = {name:"", email:"", id:"", completed:[]};
  save();
  pushProfileToForm();
  els("#completedList input[type=checkbox]").forEach(x=>x.checked=false);
  el("#profileStatus").textContent = "Profile cleared.";
  toast("Profile cleared.","warn");
}

/* =================
   Event wiring (UI)
   ================= */
document.addEventListener("DOMContentLoaded", ()=>{
  // Build completed list and fill profile
  renderCompletedList();
  pushProfileToForm();

  // Initial renders
  renderCourses();
  renderMyRegs();

  // Filters
  el("#q").addEventListener("input", renderCourses);
  el("#dept").addEventListener("change", renderCourses);
  el("#onlyOpen").addEventListener("change", renderCourses);
  el("#resetFilters").addEventListener("click", ()=>{
    el("#q").value=""; el("#dept").value=""; el("#onlyOpen").checked=false; renderCourses();
  });

  // Course actions (event delegation)
  el("#courseRows").addEventListener("click", (e)=>{
    const btn = e.target.closest("button");
    if(!btn) return;
    const code = btn.dataset.code;
    if(btn.dataset.act === "view"){ openCourseDialog(code); }
    if(btn.dataset.act === "reg"){ registerFor(code); }
  });

  // Modal actions
  el("#dlgClose").addEventListener("click", ()=> el("#courseDialog").close());
  el("#dlgRegister").addEventListener("click", (e)=> registerFor(e.currentTarget.dataset.code));

  // My registrations
  el("#myRegs").addEventListener("click", (e)=>{
    const drop = e.target.closest("button[data-drop]");
    if(drop){ dropCourse(drop.dataset.drop); }
  });

  // Profile
  el("#studentForm").addEventListener("submit", saveProfile);
  el("#clearProfile").addEventListener("click", clearProfile);
  el("#completedList").addEventListener("change", ()=>{
    // live update completed courses in profile for prereq checks
    store.profile.completed = els("#completedList input[type=checkbox]")
      .filter(x=>x.checked).map(x=>x.dataset.code);
    save();
  });

  // Export
  el("#exportBtn").addEventListener("click", exportRegs);

  // Accessibility: close dialog on Esc is default; trap focus handled natively.
});

/* ================================
   Page-level validation hooks demo
   ================================ */
// Example: guard against unload with unsaved changes (simple demo)
let touched = false;
els("input,select").forEach(i=> i.addEventListener("input", ()=> {touched=true;}));
window.addEventListener("beforeunload", (e)=>{
  if(touched){
    e.preventDefault();
    e.returnValue = "";
  }
});
</script>
</body>
</html>
